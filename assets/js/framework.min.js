!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function findParentModule(targetElement){for(var parent=targetElement.parentElement;parent;){if(parent.dataset&&parent.dataset.moduleId)return parent;parent=parent.parentElement}return void 0}function listenToDom(appInstance){clickListener=new _index.DOMListener(document.body,"click","[data-module-id] [data-event]"),clickListener.listen(function(event){return appInstance.dispatch(findParentModule(event.target).dataset.moduleId,event.target.dataset.event,event.target.dataset)})}function findModuleElements(domLink){var id=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],selector="";_.each(domLink,function(value,key){return selector+="[data-module-"+key+'="'+value+'"]'}),id&&(selector+='[data-module-id="'+id+'"]');var el=_util.toArray(document.querySelectorAll(selector));return el}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_underscore=require("underscore"),_=_interopRequireWildcard(_underscore),_index=require("./index"),_util=require("./util"),registeredApps=0,getNewAppId=function(){return++registeredApps},PublicAPIURL="https://scrmhub.com/api/activity",ActivityEndpoint="",clickListener=null,App=function(){function App(){var _this=this,params=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,App);var id=params.id||"app_"+getNewAppId();this._id=id,this._state=new _index.UserState,this._modules=[],this._unloadRequests=[],this._usePublicApi=!!params.publicApi,this.__DEV__=params.__DEV__,this._baseUrl=window.baseUrl,this._baseUrl||this.warn("No base URL set - outbound event tracking may not work as intended"),this.userId=window.puuid?this.setUserId(window.puuid):localStorage&&localStorage.getItem("puuid")?localStorage.getItem("puuid"):this.getUserIdFromCookie(),this.responseHandlers=new _index.ResponseHandler(this),params.dataBinding&&listenToDom(this),params.modules&&this.buildModules(params),-1!==["complete","interactive"].indexOf(document.readyState)?this.pageLoaded():document.addEventListener("DOMContentLoaded",function(){return _this.pageLoaded})}return _createClass(App,[{key:"warn",value:function(){this.__DEV__&&console.warn.apply(console,arguments)}},{key:"getUserIdFromCookie",value:function(){var allValues=document.cookie.split(";"),map={};return allValues.forEach(function(value){var kvp=value.split("="),key=kvp.shift();map[key]=kvp.join("=")}),map.puuid?map.puuid:null}},{key:"setUserId",value:function(puuid){return this.userId=puuid,localStorage&&localStorage.setItem("puuid",puuid),document.cookie="puuid="+puuid+"; expires=Fri, 31 Dec 9999 23:59:59 GMT",puuid}},{key:"pageLoaded",value:function(){var _this2=this;this.dispatchActivity("page","view",void 0,document.location.toString(),document.referrer.toString()),this.dispatch(void 0,"pageLoaded").then(function(){},function(err){return console.log("Error emitting page loaded event")}),window.addEventListener("click",function(event){"A"==event.target.tagName&&_this2._trackLinkClick(event)}),window.addEventListener("beforeunload",this._handleUnload.bind(this))}},{key:"_trackLinkClick",value:function(event){var link=event.target,href=link.href,target=link.target?link.target.value:null,isLocalPage=_util.isInternalUrl(this._baseUrl,href),doNotTrack="object"==typeof link.dataset&&"undefined"!=typeof link.dataset.noTrack?!!link.dataset.noTrack:!1;if(href&&!href.match(/^javascript/)){if(target&&["_self","_top","_parent"].indexOf(target))return this.dispatch(void 0,"click",{href:href}),void(isLocalPage||doNotTrack||this.dispatchActivity("page","outbound",void 0,href,document.location.toString()));var publicApiCall=this.buildActivityRequest("page",href,"outbound",void 0,document.location.toString());publicApiCall.response=!1,!this.usePublicApi||isLocalPage||doNotTrack||this._unloadRequests.push({url:this.publicApiUrl,contentType:"multipart/form-data",data:publicApiCall}),this._unloadRequests.push({url:this.apiUrl+"/click",data:this.buildApiRequest({href:href})})}}},{key:"_handleUnload",value:function(){this._unloadRequests.length&&this._unloadRequests.forEach(function(request){var reqObj=new _index.RemoteRequest(request.url);request.contentType&&reqObj.setContentType(request.contentType),reqObj.addData(request.data).isAsync(!1).post().then(function(){return console.log("Request done")})["catch"](function(err){return console.error("Unloading post failed")})})}},{key:"buildModules",value:function(params){var _this3=this;_.each(params.modules,function(moduleSpec){if(!moduleSpec.domLink||!_.isObject(moduleSpec.domLink))return _this3.warn("Unable to construct module, definition has no domLink",moduleSpec);var moduleEl=findModuleElements(moduleSpec.domLink),modules=_.chain(moduleEl).map(function(el){return el.dataset.moduleId}).uniq().value();0!=modules.length&&_.each(modules,function(moduleId){var mySpec=Object.create(moduleSpec);_this3._modules.push(new _index.Module(mySpec,_this3,moduleId))})})}},{key:"buildApiRequest",value:function(data){return{page_id:window.pageId,data:data,state:this._state.toJSON()}}},{key:"dispatch",value:function(moduleId,eventName){var _this4=this,data=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],showLoading=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];if(!_.isString(eventName))return void console.warn("Event name not specified");showLoading&&this.showLoading(!0);var url=this.apiUrl+"/"+eventName,params=this.buildApiRequest(data),request=new _index.RemoteRequest(url);return _.isString(moduleId)&&(params.module_id=moduleId),new Promise(function(resolve,reject){request.addData(params).post().then(function(response){_.isArray(response.scripts)?response.scripts.forEach(function(script){return _this4.handleServerResponse(script)}):_.isObject(response.scripts)&&_this4.handleServerResponse(response.scripts),showLoading&&_this4.showLoading(!1),resolve()})["catch"](function(){showLoading&&_this4.showLoading(!1),reject()})})}},{key:"buildActivityRequest",value:function(type,identifier,action,target,referrer){var request={action:"create",appkey:this._id,response:!0,type:type,useraction:action||null,target:target||null,id:identifier||null,referrer:referrer||null,agent:navigator.userAgent};return this.userId&&(request.puuid=this.userId),_util.deNull(request)}},{key:"dispatchActivity",value:function(type,action,target,identifier,referrer){if(this.usePublicApi){if(!type||!action)throw new Error("A type and action are required");"undefined"==typeof referrer&&(referrer=document.location.toString());var request=new _index.RemoteRequest(this.publicApiUrl),params=this.buildActivityRequest(type,identifier,action,target,referrer);request.setContentType("multipart/form-data").addData(params).post().then(this.handlePublicApiResponse.bind(this),this.handlePublicApiError.bind(this))}}},{key:"handleServerResponse",value:function(scriptDefinition){var _responseHandlers,funcName=scriptDefinition["function"],funcArgs=scriptDefinition.arguments;this.responseHandlers.has(funcName)?(_responseHandlers=this.responseHandlers).handle.apply(_responseHandlers,[this,funcName].concat(_toConsumableArray(funcArgs))):console.warn("Invalid function requested by server response: "+funcName)}},{key:"handlePublicApiResponse",value:function(response){return response.ok?void 0:this.warn("Public API response not ok")}},{key:"handlePublicApiError",value:function(err){}},{key:"showLoading",value:function(){var visible=arguments.length<=0||void 0===arguments[0]?!0:arguments[0],loadingEl=document.querySelector(".loader");loadingEl||(loadingEl=document.createElement("div"),loadingEl.classList.add("loader"),document.body.appendChild(loadingEl));var display=visible?"block":"hidden";loadingEl.style.display=display}},{key:"getModule",value:function(moduleName){return _.findWhere(this._modules,{moduleId:moduleName})}},{key:"id",get:function(){return this._id}},{key:"apiUrl",get:function(){return"api/handle"}},{key:"publicApiUrl",get:function(){return PublicAPIURL+ActivityEndpoint}},{key:"usePublicApi",get:function(){return"undefined"==typeof this._usePublicApi&&(this._usePublicApi=!0),this._usePublicApi}}]),App}();window.App=App,exports.App=App},{"./index":4,"./util":9,underscore:14}],2:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function applyToAll(selector,handler){var elements=document.querySelectorAll(selector),affectedElements=0;return _.each(elements,function(element){try{handler(element),affectedElements++}catch(e){}}),affectedElements}function cloneChildren(parentElement,handler){for(var i=0;i<parentElement.children.length;i++){var newNode=parentElement.children[i].cloneNode(!0);handler(newNode)}}function applyPrefixedStyle(element,property,value){var prefixed=prefix.prefix(property);element.style[property]=value,property!==prefixed&&(element.style[prefixed]=value)}function rotateTo(element,amount){var transform=element.style.transform,rotateStr=" rotate("+amount+"deg)";-1!==transform.indexOf("rotate")?transform=transform.replace(/\s?rotate\(.*?\)/gi,rotateStr):transform+=rotateStr,applyPrefixedStyle(element,"transform",transform.trim())}function hasClass(element,className){if(element.classList)return element.classList.contains(className);var regex=new RegExp("(?:^|s)"+className+"(?:s|$)");return regex.test(element.className)}function addClass(element,className){element.classList&&element.classList.add(className),hasClass(element,className)||(element.className+=" "+className)}function removeClass(element,className){if(element.classList&&element.classList.remove(className),hasClass(element,className)){var classList=element.className.split(""),idx=classList.indexOf(className),newList=classList.splice(idx,1).join(" ");element.className=newList}}function toggleClass(element,className){hasClass(element,className)?removeClass(element,className):addClass(element,className)}function parentAttribute(child,attribute){for(var defaultValue=arguments.length<=2||void 0===arguments[2]?void 0:arguments[2],parent=child.parentElement;parent;){if(parent.attributes[attribute])return parent.attributes[attribute].value;parent=parent.parentElement}return defaultValue}Object.defineProperty(exports,"__esModule",{value:!0});var _underscore=require("underscore"),_=_interopRequireWildcard(_underscore),_prefix=require("prefix"),prefix=_interopRequireWildcard(_prefix),DOM={applyToAll:applyToAll,cloneChildren:cloneChildren,applyPrefixedStyle:applyPrefixedStyle,parentAttribute:parentAttribute,addClass:addClass,removeClass:removeClass,toggleClass:toggleClass,rotateTo:rotateTo};exports.DOM=DOM},{prefix:13,underscore:14}],3:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function wrapSelector(selectorString){return function(element){var matchingElements=document.querySelectorAll(selectorString);return-1!==Array.prototype.indexOf.call(matchingElements,element)?!0:!1}}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_underscore=require("underscore"),_=_interopRequireWildcard(_underscore),DOMListener=function(){function DOMListener(domTarget,event,childSelector){_classCallCheck(this,DOMListener),this.listening=!1,this._listenTarget=domTarget,this._eventName=event,this._childSelector=_.isFunction(childSelector)?childSelector:wrapSelector(childSelector),this.handle=this._handle.bind(this),this._callbacks=[]}return _createClass(DOMListener,[{key:"listen",value:function(callback){return _.isFunction(callback)&&this._callbacks.push(callback),this.listening?this:(this.listening=!0,this._listenTarget.addEventListener(this._eventName,this.handle),this)}},{key:"stopListening",value:function(){this.listening=!1,this._listenTarget.removeEventListener(this._eventName,this.handle)}},{key:"removeCallback",value:function(callback){this._callbacks=_.without(this._callbacks,callback)}},{key:"_handle",value:function(event){var _this=this;this._childSelector(event.target)&&this.listening&&this._callbacks.forEach(function(listener){try{listener(event)}catch(e){console.warn("Caught an error handling the callback for event "+_this._eventName+": err.stack")}})}}]),DOMListener}();exports.DOMListener=DOMListener},{underscore:14}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _app=require("./app"),_state=require("./state"),_response=require("./response"),_request=require("./request"),_domlistener=require("./domlistener"),_module2=require("./module");exports.App=_app.App,exports.UserState=_state.UserState,exports.ResponseHandler=_response.ResponseHandler,exports.RemoteRequest=_request.RemoteRequest,exports.DOMListener=_domlistener.DOMListener,exports.Module=_module2.Module},{"./app":1,"./domlistener":3,"./module":5,"./request":6,"./response":7,"./state":8}],5:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function createEventHandler(context){return function(event){var _this=this,eventType=event.type,target=event.target;this._handlingModule=_domfunctions.DOM.parentAttribute(target,"data-module-id"),_.chain(this.events).map(function(handler,selector){return[selector,handler]}).filter(function(handler){var split=handler[0].split(" "),targetType=split.shift().toLowerCase(),selector=split.join(" ");return targetType==eventType&&(0==selector.length||-1!==_util.toArray(_this.querySelectorAll(selector)).indexOf(target))}).each(function(handler){try{_this[handler[1]](event)}catch(e){_this.app.warn("Caught an error in an event handler ("+handler[1]+"): "+e.stack)}}),delete this._handlingEvent}.bind(context)}function forAllEvents(context,toDo){_.chain(Object.keys(context.events)).map(function(val){return val.substr(0,val.indexOf(" ")).toLowerCase()}).uniq().each(function(){return toDo.apply(void 0,arguments)})}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_underscore=require("underscore"),_=_interopRequireWildcard(_underscore),_domfunctions=require("./domfunctions"),_util=require("./util"),Module=function(){function Module(props,app,moduleId){var _this2=this;if(_classCallCheck(this,Module),_.chain(props).allKeys().each(function(propName){return _this2[propName]=props[propName]}),this._app=app,this.moduleId=moduleId,this._handle=createEventHandler(this),"function"==typeof this.initialize)try{this.initialize()}catch(e){this.app.warn("Caught an error initializing module: "+e.stack)}_.isObject(this.events)&&Object.keys(this.events).length>=1&&this.listen()}return _createClass(Module,[{key:"querySelector",value:function(selector){var el=this.el;if(!Array.isArray(el))return el.querySelectorAll(selector);for(var i=0;i<el.length;i++){var result=el[i].querySelector(selector);if(result)return result}}},{key:"querySelectorAll",value:function(selector){var el=this.el;if(Array.isArray(el)){for(var childElements=[],i=0;i<el.length;i++)childElements=childElements.concat(_util.toArray(el[i].querySelectorAll(selector)));return childElements}return el.querySelectorAll()}},{key:"emit",value:function(eventType,props){var showLoading=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],moduleName=this.moduleId;if(!moduleName&&this._handlingModule)moduleName=this._handlingModule;else if(!moduleName)return this.app.warn("Attempting to emit an event from a module that has no moduleId set");return this._app.dispatch(moduleName,eventType,props,showLoading)}},{key:"listen",value:function(){var _this3=this;_.isObject(this.events)&&(this.isListening&&this.stopListening(),forAllEvents(this,function(eventType){return _.each(_this3.el,function(element){return element.addEventListener(eventType,_this3._handle,-1!==["focus","blur","change"].indexOf(eventType))})}),this.isListening=!0)}},{key:"stopListening",value:function(){var _this4=this;forAllEvents(this,function(eventType){return _.each(_this4.el,function(element){return element.el.removeEventListener(eventType,_this4._handle)})}),this.isListening=!1}},{key:"app",get:function(){return this._app}},{key:"isListening",get:function(){return _.isBoolean(this._listening)||(this._listening=!1),this._listening},set:function(value){this._listening=value}},{key:"el",get:function(){if(!(this._el instanceof Element)){var selector="";_.each(this.domLink,function(value,key){return selector+="[data-module-"+key+'="'+value+'"]'}),this.moduleId&&(selector+='[data-module-id="'+this.moduleId+'"]');var el=_util.toArray(document.querySelectorAll(selector));if(!el||0==el.length)throw new Error("Unable to find Element for this Module: "+this.moduleId);this._el=el}if(!this.moduleId){var names=_.chain(this._el).map(function(el){return el.dataset.moduleId}).uniq().value();1==names.length&&(this.moduleId=names[0])}return this._el}}]),Module}();exports.Module=Module},{"./domfunctions":2,"./util":9,underscore:14}],6:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function getContentType(contentHeader){var types=contentHeader.split(";"),optimism=types.shift().toLowerCase();return-1!==optimism.indexOf("json")?"json":-1!==optimism.indexOf("html")?"html":-1!==optimism.indexOf("xml")?"xml":-1!==optimism.indexOf("javascript")?"script":"text"}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_querystring=require("querystring"),querystring=_interopRequireWildcard(_querystring),_underscore=require("underscore"),_=_interopRequireWildcard(_underscore),RemoteRequest=function(){function RemoteRequest(url){_classCallCheck(this,RemoteRequest),this._url=url,this._data={},this._headers={},this._isAsync=!0}return _createClass(RemoteRequest,[{key:"addData",value:function(data){if(!_.isObject(data))if(_.isString(data)&&-1!==data.indexOf("="))data=querystring.parse(data);else{if(!_.isArray(data))return this;data=_.zipObject(data)}return _.assign(this._data,data),this}},{key:"setContentType",value:function(){var contentType=arguments.length<=0||void 0===arguments[0]?"application/json":arguments[0];return this.addHeader("Content-Type",contentType)}},{key:"addHeader",value:function(headerName,headerValue){return this._headers[headerName]=headerValue,this}},{key:"isAsync",value:function(async){return"undefined"==typeof async&&(async=!this._isAsync),this._isAsync=async,this}},{key:"get",value:function(){return this._doRequest("GET",querystring.stringify(this._data))}},{key:"post",value:function(){var _this=this,data=void 0;try{if(data=JSON.stringify(this._data),this._headers["Content-Type"]){if(this._headers["Content-Type"]&&"multipart/form-data"==this._headers["Content-Type"]){data=new FormData;var keys=Object.keys(this._data);keys.forEach(function(key){return data.append(key,_this._data[key])}),delete this._headers["Content-Type"]}}else this.setContentType("application/json")}catch(e){return console.warn("Unable to convert data to JSON structure: "+e.stack),new Promise(function(resolve,reject){return reject()})}return this._doRequest("POST",data)}},{key:"_doRequest",value:function(method,data){var _this2=this,xhr=this._xhr=new XMLHttpRequest,originalArgs=arguments;return xhr.open(method.toUpperCase(),this._url,this._isAsync),_.each(this._headers,function(value,key){return xhr.setRequestHeader(key,value)}),new Promise(function(resolve,reject){xhr.onload=function(){return _this2._complete(resolve,reject)},xhr.onerror=function(){return _this2._error(resolve,reject)},xhr.onabort=function(){return _this2._aborted(resolve,reject)},xhr.ontimeout=function(){return _this2._timedOut(resolve,reject,originalArgs)},xhr.send(data)})}},{key:"_complete",value:function(resolve,reject){var xhr=this._xhr,data=xhr.responseText;if(200!==xhr.status)return this._error(resolve,reject);var contentType=getContentType(xhr.getResponseHeader("Content-Type"));if("json"==contentType)try{data=JSON.parse(xhr.responseText)}catch(e){console.warn("Unable to parse response text from server")}resolve(data)}},{key:"_error",value:function(resolve,reject){var xhr=this._xhr;reject(xhr.status,xhr.responseText)}},{key:"_aborted",value:function(resolve,reject){}},{key:"_timedOut",value:function(resolve,reject,originalArgs){this._doRequest.apply(this,_toConsumableArray(originalArgs)).then(function(){return resolve.apply(void 0,arguments)})["catch"](function(){return reject.apply(void 0,arguments)})}}]),RemoteRequest}();exports.RemoteRequest=RemoteRequest},{querystring:12,underscore:14}],7:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_underscore=require("underscore"),_=_interopRequireWildcard(_underscore),_domfunctions=require("./domfunctions"),ResponseHandler=(require("./app"),function(){function ResponseHandler(handlingApp){_classCallCheck(this,ResponseHandler),this.handlingApp=handlingApp}return _createClass(ResponseHandler,[{key:"has",value:function(funcName){return-1!==["has","handle"].indexOf(funcName)?!1:_.isFunction(this[funcName])}},{key:"handle",value:function(callingApp,funcName){if(this.has(funcName))try{for(var _len=arguments.length,args=Array(_len>2?_len-2:0),_key=2;_len>_key;_key++)args[_key-2]=arguments[_key];this[funcName].apply(this,args)}catch(e){this.handlingApp.warn("Caught an error handling response in '"+funcName+"': "+e.stack)}}},{key:"replaceWith",value:function(selector,innerHtml){var affected=_domfunctions.DOM.applyToAll(selector,function(element){return element.innerHTML=innerHtml});1>affected&&this.handlingApp.warn("CSS selector for replaceWith matched no DOM elements: "+selector)}},{key:"prependTo",value:function(selector,innerHtml){var container=document.createElement("div");container.innerHTML=innerHtml;var affected=_domfunctions.DOM.applyToAll(selector,function(element){for(var i=container.children.length;i;i--){var newNode=container.children[i-1].cloneNode(!0);element.children.length?element.insertBefore(newNode,element.firstChild):element.appendChild(newNode)}});affected||this.handlingApp.warn("CSS selector for prependTo matched no DOM elements: "+selector)}},{key:"appendTo",value:function(selector,innerHtml){var container=document.createElement("div");container.innerHTML=innerHtml;var affected=_domfunctions.DOM.applyToAll(selector,function(element){_domfunctions.DOM.cloneChildren(container,function(newNode){return element.appendChild(newNode)})});affected||this.handlingApp.warn("CSS selector for appendTo matched no DOM elements: "+selector)}},{key:"insertBefore",value:function(selector,newContent){var container=document.createElement("div");container.innerHTML=newContent;var affected=_domfunctions.DOM.applyToAll(selector,function(element){_domfunctions.DOM.cloneChildren(container,function(newNode){return element.parentElement.insertBefore(newNode,element)})});affected||this.handlingApp.warn("CSS selector for appendTo matched no DOM elements: "+selector)}},{key:"insertAfter",value:function(selector,newContent){var container=document.createElement("div");container.innerHTML=newContent;var affected=_domfunctions.DOM.applyToAll(selector,function(element){var insertMethod=element.nextSibling?"nextSibling":"appendChild",insertSibling="nextSibling"==insertMethod?element.nextSibling:null;_domfunctions.DOM.cloneChildren(container,function(newNode){"nextSibling"==insertMethod?element.parentElement.insertBefore(newNode,insertSibling):element.parentElement.appendChild(newNode)})});affected||this.handlingApp.warn("CSS selector for appendTo matched no DOM elements: "+selector)}},{key:"goTo",value:function(url){document.location=url}},{key:"goToPage",value:function(pageName){var currentPath=document.location.pathname.split("/");""!==currentPath[currentPath.length-1]&&currentPath.pop(),currentPath.push(pageName);var newPath=currentPath.join("/");document.location=newPath}},{key:"forward",value:function(){this.goToPage.apply(this,arguments)}},{key:"rotate",value:function(selector,amount){var affected=_domfunctions.DOM.applyToAll(selector,function(element){return _domfunctions.DOM.rotateTo(element,amount)});1>affected&&this.handlingApp.warn("CSS selector for rotate matched no DOM elements: "+selector)}},{key:"addClass",value:function(selector,className){var affected=_domfunctions.DOM.applyToAll(selector,function(element){return _domfunctions.DOM.addClass(element,className)});1>affected&&this.handlingApp.warn("CSS selector for addClass matched no DOM elements: "+selector)}},{key:"removeClass",value:function(selector,className){var affected=_domfunctions.DOM.applyToAll(selector,function(element){return _domfunctions.DOM.removeClass(element,className)});1>affected&&this.handlingApp.warn("CSS selector for removeClass matched no DOM elements: "+selector)}},{key:"toggleClass",value:function(selector,className){var affected=_domfunctions.DOM.applyToAll(selector,function(element){return _domfunctions.DOM.toggleClass(element,className)});1>affected&&this.handlingApp.warn("CSS selector for toggleClass matched no DOM elements: "+selector)}},{key:"show",value:function(selector){var affected=_domfunctions.DOM.applyToAll(selector,function(element){return _domfunctions.DOM.removeClass(element,"hide")});1>affected&&this.handlingApp.warn("CSS selector for show matched no DOM elements: "+selector)}},{key:"hide",value:function(selector){var affected=_domfunctions.DOM.applyToAll(selector,function(element){return _domfunctions.DOM.addClass(element,"hide")});1>affected&&this.handlingApp.warn("CSS selector for hide matched no DOM elements: "+selector)}},{key:"showModule",value:function(moduleId){var module=this.handlingApp.getModule(moduleId);module?module.el.forEach(function(element){return _domfunctions.DOM.removeClass(element,"hide")}):this.handlingApp.warn("Module "+moduleId+" not found to show it")}},{key:"hideModule",value:function(moduleId){var module=this.handlingApp.getModule(moduleId);module?module.el.forEach(function(element){return _domfunctions.DOM.addClass(element,"hide")}):this.handlingApp.warn("Module "+moduleId+" not found to hide it")}},{key:"module",value:function module(moduleName,method){var module=this.handlingApp.getModule(moduleName);if(!module)return this.handlingApp.warn('Module method requested but module "'+moduleName+'" not known');if(!_.isFunction(module[method]))return this.handlingApp.warn('Module method requested but module "'+moduleName+'" has no method "'+method+'()"');try{for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_len2>_key2;_key2++)args[_key2-2]=arguments[_key2];module[method].apply(module,args)}catch(e){this.handlingApp.warn('Caught an error handling method "'+method+'()" in module "'+moduleName+'"')}}},{key:"timerSync",value:function(timerName){for(var _len3=arguments.length,syncArgs=Array(_len3>1?_len3-1:0),_key3=1;_len3>_key3;_key3++)syncArgs[_key3-1]=arguments[_key3];this.module.apply(this,[timerName,"sync"].concat(syncArgs))}},{key:"timerStart",value:function(timerName,startTime){this.module(timerName,"start",startTime)}},{key:"timerFinish",value:function(timerName){this.module(timerName,"finish")}},{key:"state",value:function(key,value){this.handlingApp._state.setValue(key,value)}}]),ResponseHandler}());
exports.ResponseHandler=ResponseHandler},{"./app":1,"./domfunctions":2,underscore:14}],8:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),stateStore={},stateStoreIds=0,UserState=function(){function UserState(){_classCallCheck(this,UserState),this._id=stateStoreIds++,stateStore[this._id]={}}return _createClass(UserState,[{key:"getValue",value:function(key){return stateStore[this._id][key]}},{key:"setValue",value:function(key,value){stateStore[this._id][key]=value}},{key:"toJSON",value:function(){return JSON.parse(JSON.stringify(stateStore[this._id]))}}]),UserState}();exports.UserState=UserState},{}],9:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function toArray(arrayLike){if(!_.isNumber(arrayLike.length))throw Error("Trying to convert non-Array-like value to Array");return Array.prototype.slice.call(arrayLike)}function deNull(object){var keys=Object.keys(object);return keys.forEach(function(key){null==object[key]&&delete object[key]}),object}function isInternalUrl(baseUrl,targetUrl){var base=document.createElement("a"),target=document.createElement("a");return base.href=baseUrl,target.href=targetUrl,base.hostname!==target.hostname?!1:"/"==base.pathname?!0:new RegExp("^base.pathname","i").test(target.pathname)?!0:void 0}Object.defineProperty(exports,"__esModule",{value:!0});var _underscore=require("underscore"),_=_interopRequireWildcard(_underscore);exports.toArray=toArray,exports.deNull=deNull,exports.isInternalUrl=isInternalUrl},{underscore:14}],10:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;len>i;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],11:[function(require,module,exports){"use strict";function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],12:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode")},{"./decode":10,"./encode":11}],13:[function(require,module,exports){function prefix(key){if(key=key.replace(/-([a-z])/g,function(_,char){return char.toUpperCase()}),void 0!==style[key])return key;for(var Key=capitalize(key),i=prefixes.length;i--;){var name=prefixes[i]+Key;if(void 0!==style[name])return name}throw new Error("unable to prefix "+key)}function capitalize(str){return str.charAt(0).toUpperCase()+str.slice(1)}function dashedPrefix(key){return key=prefix(key),upper.test(key)&&(key="-"+key.replace(upper,"-$1"),upper.lastIndex=0),key.toLowerCase()}var style=document.createElement("p").style,prefixes="O ms Moz Webkit".split(" "),upper=/([A-Z])/g,memo={};module.exports=exports=function(key){return key in memo?memo[key]:memo[key]=prefix(key)},exports.prefix=prefix,exports.dash=dashedPrefix},{}],14:[function(require,module,exports){(function(){function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&length>index;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;return arguments.length<3&&(memo=obj[keys?keys[index]:index],index+=dir),iterator(obj,iteratee,memo,keys,index,length)}}function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);for(var length=getLength(array),index=dir>0?0:length-1;index>=0&&length>index;index+=dir)if(predicate(array[index],index,array))return index;return-1}}function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if("number"==typeof idx)dir>0?i=idx>=0?idx:Math.max(idx+length,i):length=idx>=0?Math.min(idx+1,length):idx+length+1;else if(sortedIndex&&idx&&length)return idx=sortedIndex(array,item),array[idx]===item?idx:-1;if(item!==item)return idx=predicateFind(slice.call(array,i,length),_.isNaN),idx>=0?idx+i:-1;for(idx=dir>0?i:length-1;idx>=0&&length>idx;idx+=dir)if(array[idx]===item)return idx;return-1}}function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length,constructor=obj.constructor,proto=_.isFunction(constructor)&&constructor.prototype||ObjProto,prop="constructor";for(_.has(obj,prop)&&!_.contains(keys,prop)&&keys.push(prop);nonEnumIdx--;)prop=nonEnumerableProps[nonEnumIdx],prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)&&keys.push(prop)}var root=this,previousUnderscore=root._,ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create,Ctor=function(){},_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(void 0===context)return func;switch(null==argCount?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}},cb=function(value,context,argCount){return null==value?_.identity:_.isFunction(value)?optimizeCb(value,context,argCount):_.isObject(value)?_.matcher(value):_.property(value)};_.iteratee=function(value,context){return cb(value,context,1/0)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(2>length||null==obj)return obj;for(var index=1;length>index;index++)for(var source=arguments[index],keys=keysFunc(source),l=keys.length,i=0;l>i;i++){var key=keys[i];undefinedOnly&&void 0!==obj[key]||(obj[key]=source[key])}return obj}},baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;return Ctor.prototype=null,result},property=function(key){return function(obj){return null==obj?void 0:obj[key]}},MAX_ARRAY_INDEX=Math.pow(2,53)-1,getLength=property("length"),isArrayLike=function(collection){var length=getLength(collection);return"number"==typeof length&&length>=0&&MAX_ARRAY_INDEX>=length};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj))for(i=0,length=obj.length;length>i;i++)iteratee(obj[i],i,obj);else{var keys=_.keys(obj);for(i=0,length=keys.length;length>i;i++)iteratee(obj[keys[i]],keys[i],obj)}return obj},_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length),index=0;length>index;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results},_.reduce=_.foldl=_.inject=createReduce(1),_.reduceRight=_.foldr=createReduce(-1),_.find=_.detect=function(obj,predicate,context){var key;return key=isArrayLike(obj)?_.findIndex(obj,predicate,context):_.findKey(obj,predicate,context),void 0!==key&&-1!==key?obj[key]:void 0},_.filter=_.select=function(obj,predicate,context){var results=[];return predicate=cb(predicate,context),_.each(obj,function(value,index,list){predicate(value,index,list)&&results.push(value)}),results},_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)},_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;length>index;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return!1}return!0},_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;length>index;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return!0}return!1},_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){return isArrayLike(obj)||(obj=_.values(obj)),("number"!=typeof fromIndex||guard)&&(fromIndex=0),_.indexOf(obj,item,fromIndex)>=0},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return null==func?func:func.apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))},_.max=function(obj,iteratee,context){var value,computed,result=-(1/0),lastComputed=-(1/0);if(null==iteratee&&null!=obj){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;length>i;i++)value=obj[i],value>result&&(result=value)}else iteratee=cb(iteratee,context),_.each(obj,function(value,index,list){computed=iteratee(value,index,list),(computed>lastComputed||computed===-(1/0)&&result===-(1/0))&&(result=value,lastComputed=computed)});return result},_.min=function(obj,iteratee,context){var value,computed,result=1/0,lastComputed=1/0;if(null==iteratee&&null!=obj){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;length>i;i++)value=obj[i],result>value&&(result=value)}else iteratee=cb(iteratee,context),_.each(obj,function(value,index,list){computed=iteratee(value,index,list),(lastComputed>computed||computed===1/0&&result===1/0)&&(result=value,lastComputed=computed)});return result},_.shuffle=function(obj){for(var rand,set=isArrayLike(obj)?obj:_.values(obj),length=set.length,shuffled=Array(length),index=0;length>index;index++)rand=_.random(0,index),rand!==index&&(shuffled[index]=shuffled[rand]),shuffled[rand]=set[index];return shuffled},_.sample=function(obj,n,guard){return null==n||guard?(isArrayLike(obj)||(obj=_.values(obj)),obj[_.random(obj.length-1)]):_.shuffle(obj).slice(0,Math.max(0,n))},_.sortBy=function(obj,iteratee,context){return iteratee=cb(iteratee,context),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(b>a||void 0===b)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};return iteratee=cb(iteratee,context),_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)}),result}};_.groupBy=group(function(result,value,key){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,value,key){result[key]=value}),_.countBy=group(function(result,value,key){_.has(result,key)?result[key]++:result[key]=1}),_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):isArrayLike(obj)?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:isArrayLike(obj)?obj.length:_.keys(obj).length},_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];return _.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)}),[pass,fail]},_.first=_.head=_.take=function(array,n,guard){return null==array?void 0:null==n||guard?array[0]:_.initial(array,array.length-n)},_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(null==n||guard?1:n)))},_.last=function(array,n,guard){return null==array?void 0:null==n||guard?array[array.length-1]:_.rest(array,Math.max(0,array.length-n))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){for(var output=[],idx=0,i=startIndex||0,length=getLength(input);length>i;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){shallow||(value=flatten(value,shallow,strict));var j=0,len=value.length;for(output.length+=len;len>j;)output[idx++]=value[j++]}else strict||(output[idx++]=value)}return output};_.flatten=function(array,shallow){return flatten(array,shallow,!1)},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iteratee,context){_.isBoolean(isSorted)||(context=iteratee,iteratee=isSorted,isSorted=!1),null!=iteratee&&(iteratee=cb(iteratee,context));for(var result=[],seen=[],i=0,length=getLength(array);length>i;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;isSorted?(i&&seen===computed||result.push(value),seen=computed):iteratee?_.contains(seen,computed)||(seen.push(computed),result.push(value)):_.contains(result,value)||result.push(value)}return result},_.union=function(){return _.uniq(flatten(arguments,!0,!0))},_.intersection=function(array){for(var result=[],argsLength=arguments.length,i=0,length=getLength(array);length>i;i++){var item=array[i];if(!_.contains(result,item)){for(var j=1;argsLength>j&&_.contains(arguments[j],item);j++);j===argsLength&&result.push(item)}}return result},_.difference=function(array){var rest=flatten(arguments,!0,!0,1);return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){return _.unzip(arguments)},_.unzip=function(array){for(var length=array&&_.max(array,getLength).length||0,result=Array(length),index=0;length>index;index++)result[index]=_.pluck(array,index);return result},_.object=function(list,values){for(var result={},i=0,length=getLength(list);length>i;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.findIndex=createPredicateIndexFinder(1),_.findLastIndex=createPredicateIndexFinder(-1),_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);for(var value=iteratee(obj),low=0,high=getLength(array);high>low;){var mid=Math.floor((low+high)/2);iteratee(array[mid])<value?low=mid+1:high=mid}return low},_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex),_.lastIndexOf=createIndexFinder(-1,_.findLastIndex),_.range=function(start,stop,step){null==stop&&(stop=start||0,start=0),step=step||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),range=Array(length),idx=0;length>idx;idx++,start+=step)range[idx]=start;return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype),result=sourceFunc.apply(self,args);return _.isObject(result)?result:self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2),bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound},_.partial=function(func){var boundArgs=slice.call(arguments,1),bound=function(){for(var position=0,length=boundArgs.length,args=Array(length),i=0;length>i;i++)args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i];for(;position<arguments.length;)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound},_.bindAll=function(obj){var i,key,length=arguments.length;if(1>=length)throw new Error("bindAll must be passed function names");for(i=1;length>i;i++)key=arguments[i],obj[key]=_.bind(obj[key],obj);return obj},_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache,address=""+(hasher?hasher.apply(this,arguments):key);return _.has(cache,address)||(cache[address]=func.apply(this,arguments)),cache[address]};return memoize.cache={},memoize},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=_.partial(_.delay,_,1),_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=options.leading===!1?0:_.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)};return function(){var now=_.now();previous||options.leading!==!1||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,0>=remaining||remaining>wait?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=_.now()-timestamp;wait>last&&last>=0?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),timeout||(context=args=null)))};return function(){context=this,args=arguments,timestamp=_.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}},_.compose=function(){var args=arguments,start=args.length-1;return function(){for(var i=start,result=args[start].apply(this,arguments);i--;)result=args[i].call(this,result);return result}},_.after=function(times,func){return function(){return--times<1?func.apply(this,arguments):void 0}},_.before=function(times,func){var memo;return function(){return--times>0&&(memo=func.apply(this,arguments)),1>=times&&(func=null),memo}},_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=Array(length),i=0;length>i;i++)values[i]=obj[keys[i]];return values},_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var currentKey,keys=_.keys(obj),length=keys.length,results={},index=0;length>index;index++)currentKey=keys[index],results[currentKey]=iteratee(obj[currentKey],currentKey,obj);return results},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=Array(length),i=0;length>i;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;length>i;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=createAssigner(_.allKeys),_.extendOwn=_.assign=createAssigner(_.keys),_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);for(var key,keys=_.keys(obj),i=0,length=keys.length;length>i;i++)if(key=keys[i],predicate(obj[key],key,obj))return key},_.pick=function(object,oiteratee,context){var iteratee,keys,result={},obj=object;if(null==obj)return result;_.isFunction(oiteratee)?(keys=_.allKeys(obj),iteratee=optimizeCb(oiteratee,context)):(keys=flatten(arguments,!1,!1,1),iteratee=function(value,key,obj){return key in obj},obj=Object(obj));for(var i=0,length=keys.length;length>i;i++){var key=keys[i],value=obj[key];iteratee(value,key,obj)&&(result[key]=value)}return result},_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee))iteratee=_.negate(iteratee);else{var keys=_.map(flatten(arguments,!1,!1,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)},_.defaults=createAssigner(_.allKeys,!0),_.create=function(prototype,props){var result=baseCreate(prototype);return props&&_.extendOwn(result,props),result},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj},_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(null==object)return!length;for(var obj=Object(object),i=0;length>i;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return!1}return!0};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!==toString.call(b))return!1;switch(className){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays="[object Array]"===className;if(!areArrays){if("object"!=typeof a||"object"!=typeof b)return!1;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1}aStack=aStack||[],bStack=bStack||[];for(var length=aStack.length;length--;)if(aStack[length]===a)return bStack[length]===b;if(aStack.push(a),bStack.push(b),areArrays){if(length=a.length,length!==b.length)return!1;for(;length--;)if(!eq(a[length],b[length],aStack,bStack))return!1}else{var key,keys=_.keys(a);if(length=keys.length,_.keys(b).length!==length)return!1;for(;length--;)if(key=keys[length],!_.has(b,key)||!eq(a[key],b[key],aStack,bStack))return!1}return aStack.pop(),bStack.pop(),!0};_.isEqual=function(a,b){return eq(a,b)},_.isEmpty=function(obj){return null==obj?!0:isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))?0===obj.length:0===_.keys(obj).length},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"===toString.call(obj)},_.isObject=function(obj){var type=typeof obj;return"function"===type||"object"===type&&!!obj},_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return _.has(obj,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(_.isFunction=function(obj){return"function"==typeof obj||!1}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"===toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return null!=obj&&hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.noop=function(){},_.property=property,_.propertyOf=function(obj){return null==obj?function(){}:function(key){return obj[key]}},_.matcher=_.matches=function(attrs){return attrs=_.extendOwn({},attrs),function(obj){return _.isMatch(obj,attrs)}},_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;n>i;i++)accum[i]=iteratee(i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},unescapeMap=_.invert(escapeMap),createEscaper=function(map){var escaper=function(match){return map[match]},source="(?:"+_.keys(map).join("|")+")",testRegexp=RegExp(source),replaceRegexp=RegExp(source,"g");return function(string){return string=null==string?"":""+string,testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap),_.unescape=createEscaper(unescapeMap),_.result=function(object,property,fallback){var value=null==object?void 0:object[property];return void 0===value&&(value=fallback),_.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\u2028|\u2029/g,escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){!settings&&oldSettings&&(settings=oldSettings),settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,escapeChar),index=offset+match.length,escape?source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'":interpolate?source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'":evaluate&&(source+="';\n"+evaluate+"\n__p+='"),match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}var template=function(data){return render.call(this,data,_)},argument=settings.variable||"obj";return template.source="function("+argument+"){\n"+source+"}",template},_.chain=function(obj){var instance=_(obj);return instance._chain=!0,instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result(this,func.apply(_,args))}})},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!==name&&"splice"!==name||0!==obj.length||delete obj[0],result(this,obj)}}),_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}).call(this)},{}]},{},[1]);